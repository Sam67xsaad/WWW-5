 <!DOCTYPE html>
  <html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ALONE IN THE WORLD</title>
    <style>
      :root {
        color-scheme: only light;
        --bg-start: #6fa8ff;
        --bg-mid: #a8d2ff;
        --bg-end: #fcb1d8;
        --card: rgba(255, 255, 255, 0.88);
        --card-border: rgba(255, 255, 255, 0.45);
        --text: #213547;
        --muted: rgba(33, 53, 71, 0.72);
        --highlight: #5f8cff;
        --highlight-dark: #4b74e3;
        --danger: #ef4444;
        font-family: "Segoe UI", "PingFang SC", sans-serif;
      }

      body {
        margin: 0;
        min-height: 100vh;
        background: linear-gradient(135deg, var(--bg-start) 0%, var(--bg-mid) 45%, var(--bg-end) 100%);
        background-attachment: fixed;
        color: var(--text);
        display: grid;
        place-items: center;
        padding: 3.5rem 1.5rem;
        position: relative;
        overflow-x: hidden;
      }

      body::before {
        content: "";
        position: fixed;
        inset: 0;
        background:
          radial-gradient(circle at 18% 22%, rgba(255, 255, 255, 0.26), transparent 55%),
          radial-gradient(circle at 80% 15%, rgba(255, 255, 255, 0.2), transparent 45%),
          radial-gradient(circle at 52% 78%, rgba(255, 255, 255, 0.16), transparent 48%);
        pointer-events: none;
        mix-blend-mode: screen;
      }

      .app {
        width: min(780px, 94vw);
        border-radius: 26px;
        padding: 3rem;
        background: var(--card);
        border: 1px solid var(--card-border);
        backdrop-filter: blur(18px);
        box-shadow: 0 40px 70px -45px rgba(83, 124, 214, 0.6);
        display: flex;
        flex-direction: column;
        gap: 2.4rem;
      }

      .wallet-bar {
        display: flex;
        justify-content: space-between;
        align-items: center;
        gap: 1rem;
        flex-wrap: wrap;
      }

      .wallet-status {
        font-size: 0.95rem;
        letter-spacing: 0.04em;
        color: rgba(70, 98, 159, 0.9);
        word-break: break-all;
      }

      .wallet-status strong {
        font-weight: 600;
        color: var(--highlight);
      }

      .connect-btn {
        border: 1px solid rgba(123, 152, 233, 0.45);
        border-radius: 18px;
        padding: 0.75rem 1.4rem;
        font-weight: 600;
        font-size: 0.95rem;
        cursor: pointer;
        color: #fff;
        background: linear-gradient(135deg, #6fa8ff, #f6a6d6);
        box-shadow: 0 16px 34px -26px rgba(111, 168, 255, 0.55);
        transition: transform 0.2s ease, box-shadow 0.2s ease, background 0.2s ease;
        display: inline-flex;
        align-items: center;
        gap: 0.45rem;
      }

      .connect-btn:hover:not(:disabled) {
        transform: translateY(-1px);
        background: linear-gradient(135deg, #5a8ef8, #f089bb);
        box-shadow: 0 20px 40px -28px rgba(240, 137, 187, 0.45);
      }

      .connect-btn:disabled {
        cursor: not-allowed;
        opacity: 0.7;
        box-shadow: none;
      }

      .hint {
        font-size: 0.85rem;
        letter-spacing: 0.04em;
        color: rgba(60, 83, 126, 0.7);
      }

      header h1 {
        margin: 0;
        font-size: 2.25rem;
        letter-spacing: 0.08em;
        text-transform: uppercase;
        color: var(--highlight);
      }

      header p {
        margin: 1rem 0 0;
        color: var(--muted);
        line-height: 1.7;
      }

      .input-zone {
        display: grid;
        gap: 1rem;
      }

      label {
        font-size: 0.95rem;
        letter-spacing: 0.06em;
        color: var(--muted);
      }

      form {
        display: grid;
        grid-template-columns: 1fr auto;
        gap: 1rem;
      }

      input[type="text"] {
        padding: 1rem 1.2rem;
        border-radius: 18px;
        border: 1px solid rgba(148, 163, 184, 0.28);
        background: linear-gradient(160deg, rgba(255, 255, 255, 0.92), rgba(232, 244, 255, 0.78));
        color: var(--text);
        font-size: 1.05rem;
        box-shadow: 0 14px 32px -28px rgba(66, 110, 177, 0.55);
        transition: border 0.2s ease, box-shadow 0.2s ease, transform 0.2s ease;
      }

      input[type="text"]::placeholder {
        color: rgba(107, 114, 128, 0.7);
      }

      input[type="text"]:focus {
        outline: none;
        border-color: rgba(113, 162, 255, 0.6);
        box-shadow: 0 18px 36px -24px rgba(113, 162, 255, 0.5);
        transform: translateY(-1px);
      }

      .mint-btn {
        border: 1px solid rgba(132, 169, 247, 0.45);
        border-radius: 18px;
        padding: 1rem 1.6rem;
        font-weight: 600;
        font-size: 1.02rem;
        cursor: pointer;
        color: #fff;
        background: linear-gradient(135deg, #6fa8ff, #f6a6d6);
        box-shadow: 0 18px 40px -28px rgba(108, 156, 239, 0.55);
        transition: transform 0.2s ease, box-shadow 0.2s ease, background 0.2s ease;
        white-space: nowrap;
      }

      .mint-btn:hover {
        transform: translateY(-1px);
        background: linear-gradient(135deg, #5a8ef8, #f089bb);
        box-shadow: 0 22px 46px -30px rgba(240, 137, 187, 0.45);
      }

      .mint-btn:active {
        transform: translateY(0);
        box-shadow: 0 14px 30px -26px rgba(240, 137, 187, 0.4);
      }

      .mint-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        gap: 1rem;
        flex-wrap: wrap;
      }

      .mint-header h2 {
        margin: 0;
        font-size: 1.24rem;
        letter-spacing: 0.06em;
        text-transform: uppercase;
        color: rgba(84, 120, 207, 0.88);
      }

      .mint-count {
        font-size: 0.9rem;
        color: rgba(60, 83, 126, 0.68);
        letter-spacing: 0.05em;
      }

      .mint-gallery {
        display: grid;
        gap: 1.6rem;
        grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      }

      .bubble-card {
        border-radius: 26px;
        padding: 1.6rem;
        background:
          radial-gradient(circle at 20% 20%, rgba(224, 242, 255, 0.9), transparent 70%),
          linear-gradient(150deg, rgba(135, 182, 255, 0.55), rgba(250, 201, 224, 0.7));
        border: 1px solid rgba(188, 210, 255, 0.45);
        box-shadow:
          0 22px 38px -30px rgba(127, 167, 243, 0.48),
          inset 0 0 0 1px rgba(255, 255, 255, 0.45);
        display: grid;
        gap: 1.2rem;
        position: relative;
        overflow: hidden;
        transition: transform 0.25s ease, box-shadow 0.25s ease;
      }

      .bubble-card::before,
      .bubble-card::after {
        content: "";
        position: absolute;
        background: rgba(255, 255, 255, 0.55);
        border-radius: 999px;
        filter: blur(0.5px);
        pointer-events: none;
      }

      .bubble-card::before {
        width: 120px;
        height: 120px;
        top: -40px;
        right: -30px;
        opacity: 0.6;
      }

      .bubble-card::after {
        width: 60px;
        height: 60px;
        bottom: 18%;
        left: -20px;
        opacity: 0.4;
      }

      .bubble-card:hover {
        transform: translateY(-4px);
        box-shadow:
          0 26px 42px -32px rgba(127, 167, 243, 0.6),
          inset 0 0 0 1px rgba(255, 255, 255, 0.6);
      }

      .bubble-badge {
        font-size: 0.75rem;
        letter-spacing: 0.24em;
        text-transform: uppercase;
        color: rgba(66, 99, 168, 0.75);
        display: inline-flex;
        align-items: center;
        gap: 0.45rem;
      }

      .bubble-badge::before {
        content: "";
        width: 8px;
        height: 8px;
        border-radius: 50%;
        background: rgba(111, 168, 255, 0.8);
        box-shadow: 0 0 12px rgba(111, 168, 255, 0.6);
      }

      .bubble-text {
        margin: 0;
        font-size: 1.04rem;
        line-height: 1.7;
        color: rgba(33, 48, 71, 0.86);
        text-shadow: 0 1px 0 rgba(255, 255, 255, 0.4);
      }

      .bubble-owner {
        font-size: 0.82rem;
        letter-spacing: 0.05em;
        color: rgba(70, 98, 159, 0.82);
        word-break: break-all;
      }

      .bubble-owner strong {
        font-weight: 600;
      }

      .bubble-meta {
        display: grid;
        gap: 0.4rem;
        color: rgba(70, 98, 159, 0.7);
        font-size: 0.84rem;
        letter-spacing: 0.04em;
      }

      .bubble-meta .meta-row {
        display: flex;
        justify-content: space-between;
        align-items: center;
        gap: 0.8rem;
      }

      .bubble-meta button {
        border: none;
        background: linear-gradient(135deg, rgba(239, 68, 68, 0.14), rgba(239, 68, 68, 0.07));
        color: var(--danger);
        font-weight: 600;
        cursor: pointer;
        border-radius: 999px;
        padding: 0.35rem 0.65rem;
        transition: transform 0.2s ease, box-shadow 0.2s ease;
      }

      .bubble-meta button:hover {
        transform: translateY(-1px);
        box-shadow: 0 12px 22px -18px rgba(239, 68, 68, 0.5);
      }

      .empty-state {
        border-radius: 22px;
        border: 1px dashed rgba(188, 210, 255, 0.5);
        padding: 2.2rem 1.4rem;
        text-align: center;
        color: rgba(60, 83, 126, 0.68);
        letter-spacing: 0.05em;
        background: rgba(255, 255, 255, 0.55);
      }

      footer {
        text-align: center;
        font-size: 0.85rem;
        color: rgba(60, 83, 126, 0.7);
        letter-spacing: 0.08em;
      }
    </style>
  </head>
  <body>
    <main class="app">
      <section class="wallet-bar">
        <div class="wallet-status" id="walletStatus">é’±åŒ…çŠ¶æ€ï¼š<strong>æœªè¿æ¥</strong></div>
        <button class="connect-btn" type="button" id="connectWallet">
          <span>ğŸ”—</span> Connect Wallet
        </button>
      </section>
      <div class="hint" id="walletHint"></div>

      <header>
        <h1>ALONE IN THE WORLD</h1>
        <p>
         å¦‚æœæ— äººæ³¨è§†ï¼Œä½ è¿˜ä¼šæƒ³å®Œæˆä»€ä¹ˆï¼Ÿè¯·å†™ä¸‹é‚£äº›ä»åœ¨å¿ƒåº•é—ªçƒçš„å¾®å…‰ç¬é—´ï¼Œç‚¹å‡» MINTï¼Œè®©å®ƒåŒ–ä½œä¸€æšç‹¬å±äºä½ çš„å¿ƒè¿¹ NFTã€‚
        </p>
      </header>

      <section class="input-zone">
        <label for="answerInput">å†™ä¸‹ä½ çš„å¿ƒè¿¹</label>
        <form id="mintForm">
          <input
            type="text"
            id="answerInput"
            placeholder="ä¾‹å¦‚ï¼šåœ¨é»æ˜å‰æ¼«æ­¥ç©ºæ—·çš„æµ·è¾¹"
            autocomplete="off"
            aria-label="è¾“å…¥ä½ çš„ç­”æ¡ˆ"
          />
          <button class="mint-btn" type="submit" id="mintButton">Mint æˆ‘çš„å¿ƒè¿¹ NFT</button>
        </form>
      </section>

      <section aria-live="polite" aria-busy="false">
        <div class="mint-header">
          <h2>Minted Choices</h2>
          <span class="mint-count" id="mintCount">å°šæœª Mint</span>
        </div>

        <div class="empty-state" id="emptyState">
          ç›®å‰è¿˜æ²¡æœ‰è¢« Mint çš„å¿ƒè¿¹ã€‚å†™ä¸‹ç¬¬ä¸€ä¸ªå±äºä½ çš„å¿ƒè¿¹å§ã€‚
        </div>

        <div class="mint-gallery" id="mintGallery"></div>
      </section>

      <footer>Â© 2025 ALONE IN THE WORLD</footer>
    </main>

    <script src="https://cdn.jsdelivr.net/npm/ethers@6.10.0/dist/ethers.umd.min.js" crossorigin="anonymous"></script>
    <script>
      (() => {
        const STORAGE_KEY = "empty-world-mints-v1";
        const CONTRACT_ADDRESS = "0x008985a1B4415794277De116A7e75A3C531Da5C9";
        const CONTRACT_ABI = [
          {
            inputs: [{ internalType: "string", name: "answer", type: "string" }],
            name: "mint",
            outputs: [{ internalType: "uint256", name: "", type: "uint256" }],
            stateMutability: "nonpayable",
            type: "function"
          }
        ];

        const form = document.querySelector("#mintForm");
        const input = document.querySelector("#answerInput");
        const gallery = document.querySelector("#mintGallery");
        const emptyState = document.querySelector("#emptyState");
        const mintCount = document.querySelector("#mintCount");
        const connectWalletBtn = document.querySelector("#connectWallet");
        const walletStatus = document.querySelector("#walletStatus");
        const walletHint = document.querySelector("#walletHint");
        const mintButton = document.querySelector("#mintButton");

        const formatter = new Intl.DateTimeFormat("zh-CN", {
          dateStyle: "medium",
          timeStyle: "short"
        });

        const shorten = (value) => `${value.slice(0, 6)}...${value.slice(-4)}`;

        let mints = [];
        let currentAccount = null;
        let injectedProvider = null;

        const detectProvider = () => {
          const candidates = [];
          const { ethereum, $onekey, onekey } = window;

          if (ethereum?.providers?.length) candidates.push(...ethereum.providers);
          if (ethereum) candidates.push(ethereum);
          if ($onekey?.ethereum) candidates.push($onekey.ethereum);
          if (onekey?.ethereum) candidates.push(onekey.ethereum);

          const unique = [];
          for (const provider of candidates) {
            if (!provider || typeof provider.request !== "function") continue;
            if (!unique.includes(provider)) unique.push(provider);
          }
          injectedProvider = unique[0] ?? null;
        };

        const ensureProviderReady = () => {
          detectProvider();
          renderWalletStatus();

          if (!injectedProvider) {
            walletHint.textContent =
              "æœªæ£€æµ‹åˆ°æµè§ˆå™¨é’±åŒ…ï¼Œè‹¥åˆšè§£é”é’±åŒ…è¯·ç¨ç­‰ç‰‡åˆ»æˆ–åˆ·æ–°é¡µé¢ã€‚";
          }
        };

        const waitForProvider = () => new Promise((resolve) => {
          ensureProviderReady();
          if (injectedProvider) return resolve(true);

          const onEthereumInitialized = () => {
            ensureProviderReady();
            if (injectedProvider) resolve(true);
          };

          window.addEventListener("ethereum#initialized", onEthereumInitialized, { once: true });
          window.addEventListener("onekey#initialized", onEthereumInitialized, { once: true });

          setTimeout(() => {
            ensureProviderReady();
            if (injectedProvider) resolve(true);
          }, 1500);
        });

        const renderWalletStatus = () => {
          if (!injectedProvider) {
            walletStatus.innerHTML = 'é’±åŒ…çŠ¶æ€ï¼š<strong>æœªæ£€æµ‹åˆ°æµè§ˆå™¨é’±åŒ…</strong>';
            connectWalletBtn.disabled = true;
            return;
          }

          if (currentAccount) {
            walletStatus.innerHTML = `é’±åŒ…åœ°å€ï¼š<strong>${currentAccount}</strong>`;
            walletHint.textContent = "";
            connectWalletBtn.textContent = "Connected";
            connectWalletBtn.disabled = true;
          } else {
            walletStatus.innerHTML = 'é’±åŒ…çŠ¶æ€ï¼š<strong>æœªè¿æ¥</strong>';
            walletHint.textContent = "ç‚¹å‡» Connect Wallet è¿æ¥ä½ çš„æµè§ˆå™¨é’±åŒ…ã€‚";
            connectWalletBtn.innerHTML = "<span>ğŸ”—</span> Connect Wallet";
            connectWalletBtn.disabled = false;
          }
        };

        const renderMints = () => {
          gallery.innerHTML = "";
          if (!mints.length) {
            emptyState.style.display = "block";
            mintCount.textContent = "å°šæœª Mint";
            return;
          }

          emptyState.style.display = "none";
          mintCount.textContent = `å·² Mint ${mints.length} æ¡å¿ƒè¿¹`;

          mints.forEach((mint) => {
            const card = document.createElement("article");
            card.className = "bubble-card";

            const badge = document.createElement("span");
            badge.className = "bubble-badge";
            badge.textContent = mint.tokenId ? `å¿ƒè¿¹æ°”æ³¡ #${mint.tokenId}` : "å¿ƒè¿¹æ°”æ³¡ NFT";

            const content = document.createElement("p");
            content.className = "bubble-text";
            content.textContent = mint.text;

            const owner = document.createElement("div");
            owner.className = "bubble-owner";
            const displayOwner = mint.mintedBy ? shorten(mint.mintedBy) : "åŒ¿ååœ°å€";
            owner.innerHTML = `Minted by <strong title="${mint.mintedBy || ""}">${displayOwner}</strong>`;

            const meta = document.createElement("div");
            meta.className = "bubble-meta";

            const tokenRow = document.createElement("div");
            tokenRow.className = "meta-row";
            tokenRow.textContent = mint.tokenId ? `Token IDï¼š${mint.tokenId}` : "Token IDï¼šæœ¬åœ°è®°å½•";

            const timeRow = document.createElement("div");
            timeRow.className = "meta-row";
            const timestamp = document.createElement("span");
            timestamp.textContent = formatter.format(new Date(mint.mintedAt));

            const burnBtn = document.createElement("button");
            burnBtn.type = "button";
            burnBtn.textContent = "Burn";
            burnBtn.addEventListener("click", () => {
              if (!confirm("ç¡®å®šè¦ Burn æ‰è¿™ä»½å¿ƒè¿¹å—ï¼Ÿ")) return;
              mints = mints.filter((entry) => entry.id !== mint.id);
              persist();
              renderMints();
            });

            timeRow.append(timestamp, burnBtn);

            const txRow = document.createElement("div");
            txRow.className = "meta-row";
            const txLabel = document.createElement("span");
            txLabel.textContent = mint.txHash ? `Txï¼š${shorten(mint.txHash)}` : "Txï¼šæœ¬åœ°è®°å½•";
            if (mint.txHash) txLabel.title = mint.txHash;
            txRow.append(txLabel);

            meta.append(tokenRow, timeRow, txRow);
            card.append(badge, content, owner, meta);
            gallery.append(card);
          });
        };

        const persist = () => localStorage.setItem(STORAGE_KEY, JSON.stringify(mints));

        const connectWallet = async () => {
          await waitForProvider();
          if (!injectedProvider) {
            alert("æœªæ£€æµ‹åˆ°å…¼å®¹çš„é’±åŒ…æ‰©å±•ï¼Œè¯·ç¡®è®¤ OneKey/MetaMask å·²å¯ç”¨ã€‚");
            return;
          }

          connectWalletBtn.disabled = true;
          connectWalletBtn.textContent = "Connecting...";
          try {
            const accounts = await injectedProvider.request({ method: "eth_requestAccounts" });
            currentAccount = accounts?.[0] ?? null;
          } catch (error) {
            console.warn("è¿æ¥é’±åŒ…å¤±è´¥", error);
            alert(error?.message || "è¿æ¥é’±åŒ…è¢«æ‹’ç»");
          } finally {
            renderWalletStatus();
          }
        };

        const mintOnChain = async (answer) => {
          if (!window.ethers) throw new Error("æœªåŠ è½½ ethers.js");
          if (!CONTRACT_ADDRESS || CONTRACT_ADDRESS === "<YOUR_CONTRACT_ADDRESS>") {
            throw new Error("è¯·åœ¨è„šæœ¬ä¸­é…ç½®æ­£ç¡®çš„åˆçº¦åœ°å€ã€‚");
          }
          if (!Array.isArray(CONTRACT_ABI) || !CONTRACT_ABI.length) {
            throw new Error("è¯·åœ¨è„šæœ¬ä¸­å¡«å…¥åŒ…å« mint(string _answer) çš„åˆçº¦ ABIã€‚");
          }

          const provider = new ethers.BrowserProvider(injectedProvider);
          const signer = await provider.getSigner();
          const contract = new ethers.Contract(CONTRACT_ADDRESS, CONTRACT_ABI, signer);
          const tx = await contract.mint(answer);
          const receipt = await tx.wait();

          let mintedTokenId = null;
          const transferTopic = ethers.id("Transfer(address,address,uint256)");
          const erc721Interface = new ethers.Interface([
            "event Transfer(address indexed from, address indexed to, uint256 indexed tokenId)"
          ]);

          for (const log of receipt.logs) {
            if (log.address?.toLowerCase() !== CONTRACT_ADDRESS.toLowerCase()) continue;
            if (log.topics[0] !== transferTopic) continue;
            const parsed = erc721Interface.parseLog(log);
            if (
              parsed.args.from === ethers.ZeroAddress &&
              parsed.args.to?.toLowerCase() === currentAccount.toLowerCase()
            ) {
              mintedTokenId = parsed.args.tokenId.toString();
              break;
            }
          }

          return { txHash: tx.hash, tokenId: mintedTokenId };
        };

        const attachProviderListeners = () => {
          if (!injectedProvider || typeof injectedProvider.on !== "function") return;

          injectedProvider.on("accountsChanged", (accounts) => {
            currentAccount = accounts?.[0] || null;
            renderWalletStatus();
          });

          injectedProvider.on("chainChanged", () => {
            window.location.reload();
          });
        };

        connectWalletBtn.addEventListener("click", connectWallet);

        form.addEventListener("submit", async (event) => {
          event.preventDefault();
          const value = input.value.trim();
          if (!value) {
            input.focus();
            return;
          }

          await waitForProvider();
          if (!injectedProvider) {
            alert("éœ€è¦å¯ç”¨æµè§ˆå™¨é’±åŒ…æ‰©å±•æ‰èƒ½ Mintã€‚");
            return;
          }
          if (!currentAccount) {
            alert("è¯·å…ˆè¿æ¥ä½ çš„æµè§ˆå™¨é’±åŒ…ã€‚");
            connectWalletBtn.focus();
            return;
          }

          mintButton.disabled = true;
          mintButton.textContent = "Minting...";

          try {
            const { txHash, tokenId } = await mintOnChain(value);

            mints.unshift({
              id: crypto.randomUUID(),
              text: value,
              mintedAt: new Date().toISOString(),
              mintedBy: currentAccount,
              txHash,
              tokenId
            });

            persist();
            renderMints();
            input.value = "";
            input.focus();
          } catch (error) {
            console.warn("Mint å¤±è´¥", error);
            alert(error?.message || "Mint å¤±è´¥ï¼Œè¯·ç¨åå†è¯•ã€‚");
          } finally {
            mintButton.disabled = false;
            mintButton.textContent = "Mint æˆ‘çš„å¿ƒè¿¹ NFT";
          }
        });

        try {
          const cached = JSON.parse(localStorage.getItem(STORAGE_KEY) || "[]");
          if (Array.isArray(cached)) mints = cached;
        } catch {
          mints = [];
        }

        renderMints();
        waitForProvider().then(attachProviderListeners);

        setTimeout(() => {
          ensureProviderReady();
        }, 2000);

        document.addEventListener("visibilitychange", () => {
          if (document.visibilityState !== "visible") return;
          ensureProviderReady();
        });
      })();
    </script>
  </body>
  </html>